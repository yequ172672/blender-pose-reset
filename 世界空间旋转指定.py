import bpy
import re
import math

# 定义包含骨骼名称和旋转角度信息的字符串
data = """
骼 'Root' 的世界空间旋转角度：[0.0, -0.0, 0.0]
骨骼 'Bip01' 的世界空间旋转角度：[0.0, -0.0, -89.99992054220813]
骨骼 'Footsteps' 的世界空间旋转角度：[0.0, -0.0, 1.6208880167636614e-07]
骨骼 'Pelvis' 的世界空间旋转角度：[90.00000250447816, -3.38981201488796e-05, -179.99973180138954]
骨骼 'L Thigh' 的世界空间旋转角度：[88.78623007764271, 177.1525947666264, 0.025194566816193635]
骨骼 'L Calf' 的世界空间旋转角度：[88.78642132293947, -177.33112225115218, 0.14201247946989853]
骨骼 'L Foot' 的世界空间旋转角度：[-89.96887733243042, -0.16657302597225782, 179.70035094968952]
骨骼 'L Toe0' 的世界空间旋转角度：[100.58111300060848, 90.1694799883537, 10.278814861202012]
骨骼 'L Toe0Nub' 的世界空间旋转角度：[89.53392405589484, 0.13572598402998937, -90.2697198446128]
骨骼 'R Thigh' 的世界空间旋转角度：[91.21370662942192, 177.1525947666264, -0.025052201728207837]
骨骼 'R Calf' 的世界空间旋转角度：[91.21351538412516, -177.33112225115218, -0.14186769813579278]
骨骼 'R Foot' 的世界空间旋转角度：[-90.03118231803927, -0.16657087819792896, -179.7002006855278]
骨骼 'R Toe0' 的世界空间旋转角度：[79.39246600644907, 90.16950730911037, -10.304550160220973]
骨骼 'R Toe0Nub' 的世界空间旋转角度：[79.39246600644907, 90.16950730911037, -10.304553575315559]
骨骼 'Spine' 的世界空间旋转角度：[-90.00003665542401, -179.95437934530065, -7.42172796566605e-05]
骨骼 'Spine1' 的世界空间旋转角度：[-90.0000161648565, -174.39401796464165, -7.663909505508805e-05]
骨骼 'Spine2' 的世界空间旋转角度：[-90.00002982523485, -179.52111312549005, -7.984019907134857e-05]
骨骼 'Spine3' 的世界空间旋转角度：[-90.00005714599153, 170.15087222579794, -9.365142994947175e-05]
骨骼 'L Clavicle' 的世界空间旋转角度：[-22.394189043044996, -9.876839445526544, 3.4825841110820948]
骨骼 'L UpperArm' 的世界空间旋转角度：[-53.586833114509076, 2.4834275404692523, -2.4783629551996875]
骨骼 'L ForeTwist' 的世界空间旋转角度：[-53.18578148191885, -6.4811622345568685, -10.530503917022397]
骨骼 'L ForeTwist1' 的世界空间旋转角度：[-53.088311267368184, -5.801931511224011, -11.44158455795769]
骨骼 'L Forearm' 的世界空间旋转角度：[-53.29426537650616, -7.158766945980439, -9.616972091948714]
骨骼 'L Hand' 的世界空间旋转角度：[-96.2812015595728, -35.46092832154801, 81.30974791779585]
骨骼 'L Finger0' 的世界空间旋转角度：[-73.453295504232, -29.44019853045181, -32.26593999763988]
骨骼 'L Finger01' 的世界空间旋转角度：[-74.32275126481794, -23.385809567125786, -30.314278329105854]
骨骼 'L Finger02' 的世界空间旋转角度：[-73.62939827160244, -28.360593217030207, -31.901607462027645]
骨骼 'L Finger0Nub' 的世界空间旋转角度：[-73.62939827160244, -28.36058980193562, -31.90161087712223]
骨骼 'L Finger1' 的世界空间旋转角度：[-93.49649928401276, -23.904208972298708, 64.66077249510707]
骨骼 'L Finger11' 的世界空间旋转角度：[-93.32460391317105, -15.963682052693882, 64.1578041948165]
骨骼 'L Finger12' 的世界空间旋转角度：[-93.22787477414532, -8.022060595274562, 63.693419633147336]
骨骼 'L Finger1Nub' 的世界空间旋转角度：[-93.22786794395616, -8.022054618859038, 63.69344012371484]
骨骼 'L Finger2' 的世界空间旋转角度：[-94.56840185159787, -19.85439344545951, 78.64633614151688]
骨骼 'L Finger21' 的世界空间旋转角度：[-94.38115904569115, -11.283060989963571, 77.95066088398357]
骨骼 'L Finger22' 的世界空间旋转角度：[-94.29642371884796, 0.41942193329107547, 77.06033206529408]
骨骼 'L Finger2Nub' 的世界空间旋转角度：[-94.29642371884796, 0.41942169316723743, 77.06033206529408]
骨骼 'L Finger3' 的世界空间旋转角度：[-93.5488526840009, -18.96875013654064, 88.19918897885846]
骨骼 'L Finger31' 的世界空间旋转角度：[-93.36543478402938, -4.310759915871773, 87.29755619709258]
骨骼 'L Finger32' 的世界空间旋转角度：[-93.35720440607952, -1.5908942782251283, 87.13760682710922]
骨骼 'L Finger3Nub' 的世界空间旋转角度：[-93.35721123626868, -1.59089449166854, 87.13760682710922]
骨骼 'L Finger4' 的世界空间旋转角度：[-91.0642484300037, -20.537099881306258, 91.79634225619152]
骨骼 'L Finger41' 的世界空间旋转角度：[-91.00726416175829, -8.340437056830012, 91.56907454174852]
骨骼 'L Finger42' 的世界空间旋转角度：[-90.99717597235419, -1.9192957499348653, 91.45634909968662]
骨骼 'L Finger4Nub' 的世界空间旋转角度：[-90.99717597235419, -1.9192955364914537, 91.45634909968662]
骨骼 'left_uparm_Bone01' 的世界空间旋转角度：[-53.60109113440148, -2.7147267740698564, 4.559419782795257]
骨骼 'left_uparm_Bone01_End' 的世界空间旋转角度：[-53.601050153266456, -2.71471909010704, 4.559425332323958]
骨骼 'left_uparm_Bone02' 的世界空间旋转角度：[-53.58684335979283, 2.4834298883467794, -2.4783665837376843]
骨骼 'left_uparm_Bone02_End' 的世界空间旋转角度：[-53.58681945413073, 2.4834277539126637, -2.4783687181718]
骨骼 'Neck' 的世界空间旋转角度：[-89.99998201391065, -163.14298885433814, -8.179230608330759e-05]
骨骼 'Head' 的世界空间旋转角度：[-90.00000933466734, -170.70414486932566, -7.879659445148925e-05]
骨骼 'HeadNub' 的世界空间旋转角度：[-90.00000933466734, -170.70414486932566, -7.879659445148925e-05]
骨骼 'eye_l' 的世界空间旋转角度：[84.1141279683547, 91.94960487097744, 5.114646287312417]
骨骼 'eye_r' 的世界空间旋转角度：[95.88232534223323, 91.94959804078826, -4.118090097782646]
骨骼 'R Clavicle' 的世界空间旋转角度：[-157.6057544942088, -9.876852252131238, -3.482448574515752]
骨骼 'R UpperArm' 的世界空间旋转角度：[-126.41307285670429, 2.483418148959143, 2.4785157806823666]
骨骼 'R ForeTwist' 的世界空间旋转角度：[-126.81416888552413, -6.481195531729072, 10.530643935900383]
骨骼 'R ForeTwist1' 的世界空间旋转角度：[-126.91164934535854, -5.80196139330163, 11.441726284382968]
骨骼 'R Forearm' 的世界空间旋转角度：[-126.7056645003693, -7.158786155887479, 9.6171232098841]
骨骼 'R Hand' 的世界空间旋转角度：[-83.71876929843768, -35.46082928380505, -81.30961131401244]
骨骼 'R Finger0' 的世界空间旋转角度：[-106.54659339150845, -29.44026000215434, 32.2660253750045]
骨骼 'R Finger01' 的世界空间旋转角度：[-105.67721276300337, -23.385893236943122, 30.314414932889253]
骨骼 'R Finger02' 的世界空间旋转角度：[-106.37054526565137, -28.36065127363815, 31.901744065811044]
骨骼 'R Finger0Nub' 的世界空间旋转角度：[2.519236728183748, -4.591633516241976, -4.164568254424113]
骨骼 'R Finger1' 的世界空间旋转角度：[-86.50343742305188, -23.904057000589674, -64.6606290611345]
骨骼 'R Finger11' 的世界空间旋转角度：[-86.67533962408277, -15.963572769667161, -64.15767442122227]
骨骼 'R Finger12' 的世界空间旋转角度：[-86.77207559329766, -8.021957288663364, -63.693296689742276]
骨骼 'R Finger1Nub' 的世界空间旋转角度：[27.694839310703433, -68.59785062705333, -94.94468380316304]
骨骼 'R Finger2' 的世界空间旋转角度：[-85.43158949698012, -19.854335388851567, -78.64617904716597]
骨骼 'R Finger21' 的世界空间旋转角度：[-85.61883913307602, -11.283030254112306, -77.95053111038935]
骨骼 'R Finger22' 的世界空间旋转角度：[-85.70355396935169, 0.4194852993038832, -77.06021595207818]
骨骼 'R Finger2Nub' 的世界空间旋转角度：[12.101666845952415, -76.10178331717448, -92.93737999855551]
骨骼 'R Finger3' 的世界空间旋转角度：[-86.45113183438792, -18.9686903723854, -88.19903871469671]
骨骼 'R Finger31' 的世界空间旋转角度：[-86.63455656454862, -4.310641241334944, -87.29739910274166]
骨骼 'R Finger32' 的世界空间旋转角度：[-86.64278694249847, -1.590781686825529, -87.13746339313666]
骨骼 'R Finger3Nub' 的世界空间旋转角度：[-135.35566195208358, 83.34348455449133, -39.11133316874508]
骨骼 'R Finger4' 的世界空间旋转角度：[-88.93572925819595, -20.53703328696185, -91.79620565240812]
骨骼 'R Finger41' 的世界空间旋转角度：[-88.9927271868197, -8.340381561543005, -91.56892427758677]
骨骼 'R Finger42' 的世界空间旋转角度：[-89.00280854603464, -1.9192430294122091, -91.45621249590323]
骨骼 'R Finger4Nub' 的世界空间旋转角度：[-16.24076404430108, 86.50154546065178, -106.75222306666085]
骨骼 'right_uparm_Bone01' 的世界空间旋转角度：[-126.39883874247398, -2.714725066522564, -4.559272933728102]
骨骼 'right_uparm_Bone01_End' 的世界空间旋转角度：[-126.39886606323067, -2.714721224541156, -4.559277629483156]
骨骼 'right_uparm_Bone02' 的世界空间旋转角度：[-126.41310017746098, 2.4834226312707863, 2.47851898233354]
骨骼 'right_uparm_Bone02_End' 的世界空间旋转角度：[-126.41315481897433, 2.4834190027327896, 2.4785164210126016]



"""

# 使用正则表达式提取骨骼名称和旋转角度
pattern = r"骨骼 '(.*?)' 的世界空间旋转角度：\[(.*?)\]"
matches = re.findall(pattern, data)

# 获取当前活动的对象（通常是骨骼对象）
selected_object = bpy.context.active_object

# 确保当前对象是骨骼对象
if selected_object and selected_object.type == 'ARMATURE':
    # 遍历匹配结果并设置骨骼的世界空间旋转
    for match in matches:
        bone_name = match[0]
        rotation_angles = [float(angle) for angle in match[1].split(', ')]

        # 获取骨骼对象
        bone = selected_object.pose.bones.get(bone_name)

        if bone:
            # 限制角度在特定范围内，选择最接近的角度
            limited_angles = []
            for angle in rotation_angles:
                limited_angle = min((-180, -90, 0, 90, 180), key=lambda x: abs(angle - x))
                limited_angles.append(limited_angle)

            # 将角度转换为弧度
            limited_angles_rad = [math.radians(angle) for angle in limited_angles]

            # 设置骨骼的世界空间旋转
            bone.rotation_euler = limited_angles_rad

            print("已设置骨骼 '{}' 的世界空间旋转角度为：{}".format(bone_name, limited_angles))
        else:
            print("找不到骨骼 '{}'。".format(bone_name))
else:
    print("当前活动对象不是骨骼对象。")
